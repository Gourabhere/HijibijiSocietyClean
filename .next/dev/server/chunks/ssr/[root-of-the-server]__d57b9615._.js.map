{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/abc/Documents/GitHub/Hijibiji-Society-Clean/services/supabaseClient.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\r\n\r\nif (!supabaseUrl || !supabaseAnonKey) {\r\n    console.warn('Supabase credentials missing. Check your .env file.');\r\n}\r\n\r\nexport const supabase = createClient(supabaseUrl || '', supabaseAnonKey || '');\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEN;;AAIO,MAAM,WAAW,IAAA,8LAAY,EAAC,eAAe,IAAI,mBAAmB"}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/abc/Documents/GitHub/Hijibiji-Society-Clean/services/supabaseDB.ts"],"sourcesContent":["import { supabase } from './supabaseClient';\r\nimport { TaskLog, PunchLog, SupplyRequest, StaffMember } from '../types';\r\n\r\n// ===== STAFF MEMBERS =====\r\n\r\nexport async function fetchStaffMembers(): Promise<StaffMember[]> {\r\n    const { data, error } = await supabase\r\n        .from('staff_members')\r\n        .select('*')\r\n        .order('id');\r\n    if (error) throw error;\r\n    return (data || []).map(row => ({\r\n        id: row.id,\r\n        name: row.name,\r\n        role: row.role as 'Housekeeper',\r\n        avatar: row.avatar || '',\r\n        blockAssignment: row.block_assignment || '',\r\n    }));\r\n}\r\n\r\nexport async function verifyStaffPin(staffId: number, pin: string): Promise<boolean> {\r\n    const { data, error } = await supabase\r\n        .from('staff_members')\r\n        .select('pin')\r\n        .eq('id', staffId)\r\n        .single();\r\n    if (error || !data) return false;\r\n    return data.pin === pin;\r\n}\r\n\r\nexport async function insertStaffMember(staff: Omit<StaffMember, 'id'>): Promise<StaffMember> {\r\n    const { data, error } = await supabase\r\n        .from('staff_members')\r\n        .insert({\r\n            name: staff.name,\r\n            role: staff.role,\r\n            avatar: staff.avatar,\r\n            block_assignment: staff.blockAssignment,\r\n        })\r\n        .select()\r\n        .single();\r\n    if (error) throw error;\r\n    return {\r\n        id: data.id,\r\n        name: data.name,\r\n        role: data.role as 'Housekeeper',\r\n        avatar: data.avatar || '',\r\n        blockAssignment: data.block_assignment || '',\r\n    };\r\n}\r\n\r\n// ===== TASK LOGS =====\r\n\r\nexport async function fetchTaskLogs(): Promise<TaskLog[]> {\r\n    const { data, error } = await supabase\r\n        .from('task_logs')\r\n        .select('*')\r\n        .order('timestamp', { ascending: false });\r\n    if (error) throw error;\r\n    return (data || []).map(row => ({\r\n        id: row.id,\r\n        taskId: row.task_id,\r\n        staffId: row.staff_id,\r\n        timestamp: row.timestamp,\r\n        status: row.status,\r\n        imageUrl: row.image_url || undefined,\r\n        aiFeedback: row.ai_feedback || undefined,\r\n        aiRating: row.ai_rating || undefined,\r\n        block: row.block || undefined,\r\n        floor: row.floor || undefined,\r\n        flat: row.flat || undefined,\r\n    }));\r\n}\r\n\r\nexport async function insertTaskLog(log: Omit<TaskLog, 'id'>): Promise<TaskLog> {\r\n    const { data, error } = await supabase\r\n        .from('task_logs')\r\n        .insert({\r\n            task_id: log.taskId,\r\n            staff_id: log.staffId,\r\n            timestamp: log.timestamp,\r\n            status: log.status,\r\n            image_url: log.imageUrl || null,\r\n            ai_feedback: log.aiFeedback || null,\r\n            ai_rating: log.aiRating || null,\r\n            block: log.block || null,\r\n            floor: log.floor || null,\r\n            flat: log.flat || null,\r\n        })\r\n        .select()\r\n        .single();\r\n    if (error) throw error;\r\n    return {\r\n        id: data.id,\r\n        taskId: data.task_id,\r\n        staffId: data.staff_id,\r\n        timestamp: data.timestamp,\r\n        status: data.status,\r\n        imageUrl: data.image_url || undefined,\r\n        aiFeedback: data.ai_feedback || undefined,\r\n        aiRating: data.ai_rating || undefined,\r\n        block: data.block || undefined,\r\n        floor: data.floor || undefined,\r\n        flat: data.flat || undefined,\r\n    };\r\n}\r\n\r\n// ===== PUNCH LOGS =====\r\n\r\nexport async function fetchPunchLogs(): Promise<PunchLog[]> {\r\n    const { data, error } = await supabase\r\n        .from('punch_logs')\r\n        .select('*')\r\n        .order('timestamp', { ascending: false });\r\n    if (error) throw error;\r\n    return (data || []).map(row => ({\r\n        id: row.id,\r\n        staffId: row.staff_id,\r\n        type: row.type as 'IN' | 'OUT',\r\n        timestamp: row.timestamp,\r\n    }));\r\n}\r\n\r\nexport async function insertPunchLog(log: Omit<PunchLog, 'id'>): Promise<PunchLog> {\r\n    const { data, error } = await supabase\r\n        .from('punch_logs')\r\n        .insert({\r\n            staff_id: log.staffId,\r\n            type: log.type,\r\n            timestamp: log.timestamp,\r\n        })\r\n        .select()\r\n        .single();\r\n    if (error) throw error;\r\n    return {\r\n        id: data.id,\r\n        staffId: data.staff_id,\r\n        type: data.type as 'IN' | 'OUT',\r\n        timestamp: data.timestamp,\r\n    };\r\n}\r\n\r\n// ===== SUPPLY REQUESTS =====\r\n\r\nexport async function fetchSupplyRequests(): Promise<SupplyRequest[]> {\r\n    const { data, error } = await supabase\r\n        .from('supply_requests')\r\n        .select('*')\r\n        .order('timestamp', { ascending: false });\r\n    if (error) throw error;\r\n    return (data || []).map(row => ({\r\n        id: row.id,\r\n        item: row.item,\r\n        quantity: row.quantity,\r\n        urgency: row.urgency as 'LOW' | 'MEDIUM' | 'HIGH',\r\n        status: row.status as 'OPEN' | 'FULFILLED' | 'REJECTED',\r\n        requesterId: row.requester_id,\r\n        timestamp: row.timestamp,\r\n    }));\r\n}\r\n\r\nexport async function insertSupplyRequest(req: Omit<SupplyRequest, 'id'>): Promise<SupplyRequest> {\r\n    const { data, error } = await supabase\r\n        .from('supply_requests')\r\n        .insert({\r\n            item: req.item,\r\n            quantity: req.quantity,\r\n            urgency: req.urgency,\r\n            status: req.status,\r\n            requester_id: req.requesterId,\r\n            timestamp: req.timestamp,\r\n        })\r\n        .select()\r\n        .single();\r\n    if (error) throw error;\r\n    return {\r\n        id: data.id,\r\n        item: data.item,\r\n        quantity: data.quantity,\r\n        urgency: data.urgency as 'LOW' | 'MEDIUM' | 'HIGH',\r\n        status: data.status as 'OPEN' | 'FULFILLED' | 'REJECTED',\r\n        requesterId: data.requester_id,\r\n        timestamp: data.timestamp,\r\n    };\r\n}\r\n\r\nexport async function updateSupplyStatus(id: string, status: 'OPEN' | 'FULFILLED' | 'REJECTED'): Promise<void> {\r\n    const { error } = await supabase\r\n        .from('supply_requests')\r\n        .update({ status })\r\n        .eq('id', id);\r\n    if (error) throw error;\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;;AAKO,eAAe;IAClB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,sIAAQ,CACjC,IAAI,CAAC,iBACL,MAAM,CAAC,KACP,KAAK,CAAC;IACX,IAAI,OAAO,MAAM;IACjB,OAAO,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAA,MAAO,CAAC;YAC5B,IAAI,IAAI,EAAE;YACV,MAAM,IAAI,IAAI;YACd,MAAM,IAAI,IAAI;YACd,QAAQ,IAAI,MAAM,IAAI;YACtB,iBAAiB,IAAI,gBAAgB,IAAI;QAC7C,CAAC;AACL;AAEO,eAAe,eAAe,OAAe,EAAE,GAAW;IAC7D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,sIAAQ,CACjC,IAAI,CAAC,iBACL,MAAM,CAAC,OACP,EAAE,CAAC,MAAM,SACT,MAAM;IACX,IAAI,SAAS,CAAC,MAAM,OAAO;IAC3B,OAAO,KAAK,GAAG,KAAK;AACxB;AAEO,eAAe,kBAAkB,KAA8B;IAClE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,sIAAQ,CACjC,IAAI,CAAC,iBACL,MAAM,CAAC;QACJ,MAAM,MAAM,IAAI;QAChB,MAAM,MAAM,IAAI;QAChB,QAAQ,MAAM,MAAM;QACpB,kBAAkB,MAAM,eAAe;IAC3C,GACC,MAAM,GACN,MAAM;IACX,IAAI,OAAO,MAAM;IACjB,OAAO;QACH,IAAI,KAAK,EAAE;QACX,MAAM,KAAK,IAAI;QACf,MAAM,KAAK,IAAI;QACf,QAAQ,KAAK,MAAM,IAAI;QACvB,iBAAiB,KAAK,gBAAgB,IAAI;IAC9C;AACJ;AAIO,eAAe;IAClB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,sIAAQ,CACjC,IAAI,CAAC,aACL,MAAM,CAAC,KACP,KAAK,CAAC,aAAa;QAAE,WAAW;IAAM;IAC3C,IAAI,OAAO,MAAM;IACjB,OAAO,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAA,MAAO,CAAC;YAC5B,IAAI,IAAI,EAAE;YACV,QAAQ,IAAI,OAAO;YACnB,SAAS,IAAI,QAAQ;YACrB,WAAW,IAAI,SAAS;YACxB,QAAQ,IAAI,MAAM;YAClB,UAAU,IAAI,SAAS,IAAI;YAC3B,YAAY,IAAI,WAAW,IAAI;YAC/B,UAAU,IAAI,SAAS,IAAI;YAC3B,OAAO,IAAI,KAAK,IAAI;YACpB,OAAO,IAAI,KAAK,IAAI;YACpB,MAAM,IAAI,IAAI,IAAI;QACtB,CAAC;AACL;AAEO,eAAe,cAAc,GAAwB;IACxD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,sIAAQ,CACjC,IAAI,CAAC,aACL,MAAM,CAAC;QACJ,SAAS,IAAI,MAAM;QACnB,UAAU,IAAI,OAAO;QACrB,WAAW,IAAI,SAAS;QACxB,QAAQ,IAAI,MAAM;QAClB,WAAW,IAAI,QAAQ,IAAI;QAC3B,aAAa,IAAI,UAAU,IAAI;QAC/B,WAAW,IAAI,QAAQ,IAAI;QAC3B,OAAO,IAAI,KAAK,IAAI;QACpB,OAAO,IAAI,KAAK,IAAI;QACpB,MAAM,IAAI,IAAI,IAAI;IACtB,GACC,MAAM,GACN,MAAM;IACX,IAAI,OAAO,MAAM;IACjB,OAAO;QACH,IAAI,KAAK,EAAE;QACX,QAAQ,KAAK,OAAO;QACpB,SAAS,KAAK,QAAQ;QACtB,WAAW,KAAK,SAAS;QACzB,QAAQ,KAAK,MAAM;QACnB,UAAU,KAAK,SAAS,IAAI;QAC5B,YAAY,KAAK,WAAW,IAAI;QAChC,UAAU,KAAK,SAAS,IAAI;QAC5B,OAAO,KAAK,KAAK,IAAI;QACrB,OAAO,KAAK,KAAK,IAAI;QACrB,MAAM,KAAK,IAAI,IAAI;IACvB;AACJ;AAIO,eAAe;IAClB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,sIAAQ,CACjC,IAAI,CAAC,cACL,MAAM,CAAC,KACP,KAAK,CAAC,aAAa;QAAE,WAAW;IAAM;IAC3C,IAAI,OAAO,MAAM;IACjB,OAAO,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAA,MAAO,CAAC;YAC5B,IAAI,IAAI,EAAE;YACV,SAAS,IAAI,QAAQ;YACrB,MAAM,IAAI,IAAI;YACd,WAAW,IAAI,SAAS;QAC5B,CAAC;AACL;AAEO,eAAe,eAAe,GAAyB;IAC1D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,sIAAQ,CACjC,IAAI,CAAC,cACL,MAAM,CAAC;QACJ,UAAU,IAAI,OAAO;QACrB,MAAM,IAAI,IAAI;QACd,WAAW,IAAI,SAAS;IAC5B,GACC,MAAM,GACN,MAAM;IACX,IAAI,OAAO,MAAM;IACjB,OAAO;QACH,IAAI,KAAK,EAAE;QACX,SAAS,KAAK,QAAQ;QACtB,MAAM,KAAK,IAAI;QACf,WAAW,KAAK,SAAS;IAC7B;AACJ;AAIO,eAAe;IAClB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,sIAAQ,CACjC,IAAI,CAAC,mBACL,MAAM,CAAC,KACP,KAAK,CAAC,aAAa;QAAE,WAAW;IAAM;IAC3C,IAAI,OAAO,MAAM;IACjB,OAAO,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAA,MAAO,CAAC;YAC5B,IAAI,IAAI,EAAE;YACV,MAAM,IAAI,IAAI;YACd,UAAU,IAAI,QAAQ;YACtB,SAAS,IAAI,OAAO;YACpB,QAAQ,IAAI,MAAM;YAClB,aAAa,IAAI,YAAY;YAC7B,WAAW,IAAI,SAAS;QAC5B,CAAC;AACL;AAEO,eAAe,oBAAoB,GAA8B;IACpE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,sIAAQ,CACjC,IAAI,CAAC,mBACL,MAAM,CAAC;QACJ,MAAM,IAAI,IAAI;QACd,UAAU,IAAI,QAAQ;QACtB,SAAS,IAAI,OAAO;QACpB,QAAQ,IAAI,MAAM;QAClB,cAAc,IAAI,WAAW;QAC7B,WAAW,IAAI,SAAS;IAC5B,GACC,MAAM,GACN,MAAM;IACX,IAAI,OAAO,MAAM;IACjB,OAAO;QACH,IAAI,KAAK,EAAE;QACX,MAAM,KAAK,IAAI;QACf,UAAU,KAAK,QAAQ;QACvB,SAAS,KAAK,OAAO;QACrB,QAAQ,KAAK,MAAM;QACnB,aAAa,KAAK,YAAY;QAC9B,WAAW,KAAK,SAAS;IAC7B;AACJ;AAEO,eAAe,mBAAmB,EAAU,EAAE,MAAyC;IAC1F,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,sIAAQ,CAC3B,IAAI,CAAC,mBACL,MAAM,CAAC;QAAE;IAAO,GAChB,EAAE,CAAC,MAAM;IACd,IAAI,OAAO,MAAM;AACrB"}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/abc/Documents/GitHub/Hijibiji-Society-Clean/contexts/AuthContext.tsx"],"sourcesContent":["\"use client\"\r\nimport React, { createContext, useContext, useState, ReactNode } from 'react';\r\nimport { verifyStaffPin } from '../services/supabaseDB';\r\n\r\nexport type AppRole = 'admin' | 'staff';\r\n\r\ninterface AuthContextType {\r\n    isLoggedIn: boolean;\r\n    role: AppRole | null;\r\n    staffId: number | null;\r\n    staffName: string | null;\r\n    loading: boolean;\r\n    loginAsStaff: (staffId: number, staffName: string, pin: string) => Promise<{ error: string | null }>;\r\n    loginAsAdmin: (username: string, password: string) => Promise<{ error: string | null }>;\r\n    logout: () => void;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\nexport const useAuth = () => {\r\n    const ctx = useContext(AuthContext);\r\n    if (!ctx) throw new Error('useAuth must be used within AuthProvider');\r\n    return ctx;\r\n};\r\n\r\nexport const AuthProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\r\n    const [isLoggedIn, setIsLoggedIn] = useState(false);\r\n    const [role, setRole] = useState<AppRole | null>(null);\r\n    const [staffId, setStaffId] = useState<number | null>(null);\r\n    const [staffName, setStaffName] = useState<string | null>(null);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const loginAsStaff = async (id: number, name: string, pin: string): Promise<{ error: string | null }> => {\r\n        setLoading(true);\r\n        try {\r\n            const valid = await verifyStaffPin(id, pin);\r\n            if (!valid) {\r\n                setLoading(false);\r\n                return { error: 'Incorrect PIN. Try again.' };\r\n            }\r\n            setIsLoggedIn(true);\r\n            setRole('staff');\r\n            setStaffId(id);\r\n            setStaffName(name);\r\n            setLoading(false);\r\n            return { error: null };\r\n        } catch (err) {\r\n            setLoading(false);\r\n            return { error: 'Could not verify PIN. Check your connection.' };\r\n        }\r\n    };\r\n\r\n    const loginAsAdmin = async (username: string, password: string): Promise<{ error: string | null }> => {\r\n        setLoading(true);\r\n        // Hardcoded admin credentials\r\n        if (username === 'admin' && password === 'admin123') {\r\n            setIsLoggedIn(true);\r\n            setRole('admin');\r\n            setStaffId(null);\r\n            setStaffName('Admin');\r\n            setLoading(false);\r\n            return { error: null };\r\n        }\r\n        setLoading(false);\r\n        return { error: 'Invalid admin credentials.' };\r\n    };\r\n\r\n    const logout = () => {\r\n        setIsLoggedIn(false);\r\n        setRole(null);\r\n        setStaffId(null);\r\n        setStaffName(null);\r\n    };\r\n\r\n    return (\r\n        <AuthContext.Provider value={{ isLoggedIn, role, staffId, staffName, loading, loginAsStaff, loginAsAdmin, logout }}>\r\n            {children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAFA;;;;AAiBA,MAAM,4BAAc,IAAA,sNAAa,EAA8B;AAExD,MAAM,UAAU;IACnB,MAAM,MAAM,IAAA,mNAAU,EAAC;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACX;AAEO,MAAM,eAAkD,CAAC,EAAE,QAAQ,EAAE;IACxE,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAC7C,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAiB;IACjD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAgB;IACtD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAgB;IAC1D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,MAAM,eAAe,OAAO,IAAY,MAAc;QAClD,WAAW;QACX,IAAI;YACA,MAAM,QAAQ,MAAM,IAAA,wIAAc,EAAC,IAAI;YACvC,IAAI,CAAC,OAAO;gBACR,WAAW;gBACX,OAAO;oBAAE,OAAO;gBAA4B;YAChD;YACA,cAAc;YACd,QAAQ;YACR,WAAW;YACX,aAAa;YACb,WAAW;YACX,OAAO;gBAAE,OAAO;YAAK;QACzB,EAAE,OAAO,KAAK;YACV,WAAW;YACX,OAAO;gBAAE,OAAO;YAA+C;QACnE;IACJ;IAEA,MAAM,eAAe,OAAO,UAAkB;QAC1C,WAAW;QACX,8BAA8B;QAC9B,IAAI,aAAa,WAAW,aAAa,YAAY;YACjD,cAAc;YACd,QAAQ;YACR,WAAW;YACX,aAAa;YACb,WAAW;YACX,OAAO;gBAAE,OAAO;YAAK;QACzB;QACA,WAAW;QACX,OAAO;YAAE,OAAO;QAA6B;IACjD;IAEA,MAAM,SAAS;QACX,cAAc;QACd,QAAQ;QACR,WAAW;QACX,aAAa;IACjB;IAEA,qBACI,8OAAC,YAAY,QAAQ;QAAC,OAAO;YAAE;YAAY;YAAM;YAAS;YAAW;YAAS;YAAc;YAAc;QAAO;kBAC5G;;;;;;AAGb"}}]
}